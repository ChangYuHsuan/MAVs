

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head><div class = "head"> </div>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Callbacks &mdash; Artelys Knitro 10.3 User&#39;s Manual</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/Artelys_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Artelys Knitro 10.3 User&#39;s Manual" href="../index.html"/>
        <link rel="up" title="User guide" href="../2_userGuide.html"/>
        <link rel="next" title="Other programmatic interfaces" href="otherProgInterfaces.html"/>
        <link rel="prev" title="Obtaining information" href="obtainingInformation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Artelys Knitro User's Manual
          

          
          </a>

          
            
            
              <div class="version">
                10.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../2_userGuide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gettingStarted.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="knitroOptions.html">Setting options</a></li>
<li class="toctree-l2"><a class="reference internal" href="derivatives.html">Derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="multistart.html">Multistart</a></li>
<li class="toctree-l2"><a class="reference internal" href="minlp.html">Mixed-integer nonlinear programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="complementarity.html">Complementarity constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="ktrlsq.html">Nonlinear Least-Squares</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithms.html">Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="feasibility.html">Feasibility and infeasibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallelism.html">Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuner.html">The Knitro-Tuner</a></li>
<li class="toctree-l2"><a class="reference internal" href="termination.html">Termination criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="obtainingInformation.html">Obtaining information</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Callbacks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="otherProgInterfaces.html">Other programmatic interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="specialProblems.html">Special problem classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html">Tips and tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../3_referenceManual.html">Reference manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Artelys Knitro User's Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../2_userGuide.html">User guide</a> &raquo;</li>
      
    <li>Callbacks</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="callbacks">
<span id="callback"></span><h1>Callbacks</h1>
<p id="index-0">Knitro needs to evaluate the objective function and constraints
(function values and ideally, their derivatives) at various points along the
optimization process. In order to pass this information to
the solver, you need to provide a handle to a user-defined
function that performs the necessary computation.  This is referred to
as a <em>callback</em>.</p>
<p>Callbacks in Knitro require you to supply several function
pointers that Knitro calls when it needs new function, gradient
or Hessian values, or to execute a user-provided <em>newpoint</em> routine.
For convenience, the function, gradient and Hessian callback routines
take the same list of arguments.</p>
<p>If your callback requires additional parameters, you are encouraged to
create a structure containing them and pass its address as the <em>userParams</em>
pointer. Knitro does not modify or dereference the <em>userParams</em>
pointer, so it is safe to use for this purpose.</p>
<p>The C language prototypes for the Knitro callback functions used for
evaluations and the <em>newpoint</em> feature are
defined in <code class="file docutils literal"><span class="pre">knitro.h</span></code>.  The prototype used for evaluations is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="nf">KTR_callback</span> <span class="p">(</span>
        <span class="k">const</span> <span class="kt">int</span>             <span class="n">evalRequestCode</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span>             <span class="n">n</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span>             <span class="n">m</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span>             <span class="n">nnzJ</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span>             <span class="n">nnzH</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">x</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">lambda</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">obj</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">c</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">objGrad</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">jac</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">hessian</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">hessVector</span><span class="p">,</span>
              <span class="kt">void</span>   <span class="o">*</span>        <span class="n">userParams</span><span class="p">);</span>
</pre></div>
</div>
<p>while the prototype used for the <em>newpoint</em> callback is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="nf">KTR_newpt_callback</span> <span class="p">(</span>
                    <span class="n">KTR_context_ptr</span>       <span class="n">kc</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">int</span>             <span class="n">n</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">int</span>             <span class="n">m</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">int</span>             <span class="n">nnzJ</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">x</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">lambda</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span>          <span class="n">obj</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">c</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">objGrad</span><span class="p">,</span>
                    <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">jac</span><span class="p">,</span>
                          <span class="kt">void</span>   <span class="o">*</span>        <span class="n">userParams</span><span class="p">);</span>
</pre></div>
</div>
<p>The prototype used for evaluations in the nonlinear least-squares API is:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="nf">KTR_lsq_callback</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span>            <span class="n">n</span><span class="p">,</span>
                             <span class="k">const</span> <span class="kt">int</span>            <span class="n">m</span><span class="p">,</span>
                             <span class="k">const</span> <span class="kt">int</span>            <span class="n">nnzJ</span><span class="p">,</span>
                             <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">x</span><span class="p">,</span>
                                   <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">res</span><span class="p">,</span>
                                   <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">jac</span><span class="p">,</span>
                                   <span class="kt">void</span> <span class="o">*</span>         <span class="n">userParams</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that this last callback type does not use the <em>evalRequestCode</em> parameter.</p>
<p>The <em>evalRequestCode</em> input indicates which callback utility
Knitro would like you to perform and can take on any of the following values:</p>
<ul class="simple">
<li>KTR_RC_EVALFC (1):
Evaluate functions <em>f(x)</em> (objective) and <em>c(x)</em> (constraints).</li>
<li>KTR_RC_EVALGA (2):
Evaluate gradient of <em>f(x)</em> and the constraint Jacobian matrix.</li>
<li>KTR_RC_EVALH (3):
Evaluate the Hessian <span class="math">H(x,\lambda)</span>.</li>
<li>KTR_RC_EVALHV (7):
Evaluate the Hessian <span class="math">H(x,\lambda)</span> times a vector.</li>
<li>KTR_RC_EVALH_NO_F (8):
Evaluate the Hessian <span class="math">H(x,\lambda)</span> <em>without the objective component included</em>.</li>
<li>KTR_RC_EVALHV_NO_F (9):
Evaluate the Hessian <span class="math">H(x,\lambda)</span> times a vector
<em>without the objective component included</em>.</li>
</ul>
<p>See the <a class="reference internal" href="derivatives.html#sec-derivatives"><span class="std std-ref">Derivatives</span></a> section for details on how to compute the Jacobian
and Hessian matrices in a form suitable for Knitro.</p>
<p>The callback functions for evaluating the functions, gradients and
Hessian or for performing some newpoint task, are set as described
below.  Each user callback routine should return an
<em>int</em> value of 0 if successful, or a negative value to indicate
that an error occurred during execution of the user-provided function.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* This callback should modify &quot;obj&quot; and &quot;c&quot;. */</span>
<span class="kt">int</span> <span class="nf">KTR_set_func_callback</span> <span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_callback</span> <span class="o">*</span> <span class="n">func</span><span class="p">);</span>

<span class="cm">/* This callback should modify &quot;res&quot;. */</span>
<span class="kt">int</span> <span class="nf">KTR_lsq_set_res_callback</span><span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_lsq_callback</span> <span class="o">*</span> <span class="k">const</span> <span class="n">fnPtr</span><span class="p">);</span>

<span class="cm">/* This callback should modify &quot;objGrad&quot; and &quot;jac&quot;. */</span>
<span class="kt">int</span> <span class="nf">KTR_set_grad_callback</span> <span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_callback</span> <span class="o">*</span> <span class="n">func</span><span class="p">);</span>

<span class="cm">/* This callback should modify &quot;jac&quot;. */</span>
<span class="kt">int</span> <span class="nf">KTR_lsq_set_jac_callback</span><span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_lsq_callback</span> <span class="o">*</span> <span class="k">const</span> <span class="n">fnPtr</span><span class="p">);</span>

<span class="cm">/* This callback should modify &quot;hessian&quot; or &quot;hessVector&quot;,</span>
<span class="cm">   depending on the value of &quot;evalRequestCode&quot;. */</span>
<span class="kt">int</span> <span class="nf">KTR_set_hess_callback</span> <span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_callback</span> <span class="o">*</span> <span class="n">func</span><span class="p">);</span>

<span class="cm">/* This callback should modify nothing. */</span>
<span class="kt">int</span> <span class="nf">KTR_set_newpt_callback</span> <span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_newpt_callback</span> <span class="o">*</span> <span class="n">func</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To enable <em>newpoint</em> callbacks, set <a class="reference internal" href="../3_referenceManual/userOptions.html#newpoint" title="newpoint"><code class="xref c c-type docutils literal"><span class="pre">newpoint</span></code></a> = <em>user</em>.
This callback should only be used for continuous problems.</p>
</div>
<p>Knitro also provides a special callback function for output printing.
By default Knitro prints to <em>stdout</em> or a <code class="file docutils literal"><span class="pre">knitro.log</span></code> file,
as determined by the <a class="reference internal" href="../3_referenceManual/userOptions.html#outmode" title="outmode"><code class="xref c c-type docutils literal"><span class="pre">outmode</span></code></a> option.
Alternatively, you can define a callback function to handle
all output.  This callback function can be set as shown below</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">KTR_set_puts_callback</span> <span class="p">(</span><span class="n">KTR_context_ptr</span> <span class="n">kc</span><span class="p">,</span> <span class="n">KTR_puts</span> <span class="o">*</span> <span class="n">puts_func</span><span class="p">);</span>
</pre></div>
</div>
<p>The prototype for the Knitro callback function used for handling
output is</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">int</span> <span class="nf">KTR_puts</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span> <span class="n">user</span><span class="p">);</span>
</pre></div>
</div>
<p>In addition to the callbacks defined above, Knitro makes additional callbacks
available to the user for features such as multi-start and MINLP.  Please
see a complete list and description of Knitro callback functions in
the <a class="reference internal" href="../3_referenceManual/callableLibrary/API.html#sec-api"><span class="std std-ref">Knitro API</span></a> section in the Reference Manual.</p>
<p>For information on setting callbacks in the object-oriented interface,
see the <a class="reference internal" href="../3_referenceManual/ooInterfaceReference.html#sec-oointerfacereference"><span class="std std-ref">Object-oriented interface reference</span></a>.</p>
<div class="section" id="example">
<h2>Example</h2>
<p>Consider the following nonlinear optimization problem from the
Hock and Schittkowski test set.</p>
<div class="math">
<p><span class="math">\min \; 100 - (x_2 - x_1^2)^2 + (1 - x_1)^2     \\
1 \leq x_1 x_2, \; 0 \leq x_1 + x_2^2, \; x_1 \leq 0.5 .</span></p>
</div><p>This problem is coded as <code class="file docutils literal"><span class="pre">examples/C/problemHS15.c</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Knitro distribution comes with several C language programs in
the directory <em>examples/C</em>.     The instructions in
<code class="file docutils literal"><span class="pre">examples/C/README.txt</span></code> explain how to compile and run the examples.
This section overviews the coding of driver programs using the callback interface,
but the working examples provide more complete detail.</p>
</div>
<p>Every driver starts by allocating a new Knitro solver instance
and checking that it succeeded (<a class="reference internal" href="../3_referenceManual/callableLibrary/API.html#KTR_new" title="KTR_new"><code class="xref c c-func docutils literal"><span class="pre">KTR_new()</span></code></a> might return NULL
if the Artelys license check fails):</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;knitro.h&quot;</span><span class="cp"></span>

<span class="cm">/*... Include other headers, define main() ...*/</span>

<span class="n">KTR_context</span>     <span class="o">*</span><span class="n">kc</span><span class="p">;</span>

<span class="cm">/*... Declare other local variables ...*/</span>

<span class="cm">/*---- CREATE A NEW KNITRO SOLVER INSTANCE. */</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">KTR_new</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">kc</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Failed to find an Artelys license.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The next task is to load the problem definition into the solver
using <a class="reference internal" href="../3_referenceManual/callableLibrary/API.html#KTR_init_problem" title="KTR_init_problem"><code class="xref c c-func docutils literal"><span class="pre">KTR_init_problem()</span></code></a>.
The problem has 2 unknowns and 2 constraints, and it is easily seen that all
first and second partial derivatives are generally nonzero.     The code
below captures the problem definition and passes it to Knitro:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/*---- DEFINE PROBLEM SIZES. */</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">nnzJ</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">nnzH</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="cm">/*... allocate memory for xLoBnds, xUpBnds, etc. ...*/</span>

<span class="cm">/*---- DEFINE THE OBJECTIVE FUNCTION AND VARIABLE BOUNDS. */</span>
<span class="n">objType</span> <span class="o">=</span> <span class="n">KTR_OBJTYPE_GENERAL</span><span class="p">;</span>
<span class="n">objGoal</span> <span class="o">=</span> <span class="n">KTR_OBJGOAL_MINIMIZE</span><span class="p">;</span>
<span class="n">xLoBnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">KTR_INFBOUND</span><span class="p">;</span>
<span class="n">xLoBnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">KTR_INFBOUND</span><span class="p">;</span>
<span class="n">xUpBnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">xUpBnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_INFBOUND</span><span class="p">;</span>

<span class="cm">/*---- DEFINE THE CONSTRAINT FUNCTIONS. */</span>
<span class="n">cType</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_CONTYPE_QUADRATIC</span><span class="p">;</span>
<span class="n">cType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_CONTYPE_QUADRATIC</span><span class="p">;</span>
<span class="n">cLoBnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
<span class="n">cLoBnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="n">cUpBnds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_INFBOUND</span><span class="p">;</span>
<span class="n">cUpBnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_INFBOUND</span><span class="p">;</span>

<span class="cm">/*---- PROVIDE FIRST DERIVATIVE STRUCTURAL INFORMATION. */</span>
<span class="n">jacIndexCons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">jacIndexCons</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">jacIndexCons</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">jacIndexCons</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">jacIndexVars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">jacIndexVars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">jacIndexVars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">jacIndexVars</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="cm">/*---- PROVIDE SECOND DERIVATIVE STRUCTURAL INFORMATION. */</span>
<span class="n">hessIndexRows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">hessIndexRows</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">hessIndexRows</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">hessIndexCols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">hessIndexCols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">hessIndexCols</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="cm">/*---- CHOOSE AN INITIAL START POINT. */</span>
<span class="n">xInitial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">;</span>
<span class="n">xInitial</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>   <span class="mf">1.0</span><span class="p">;</span>

<span class="cm">/*---- INITIALIZE KNITRO WITH THE PROBLEM DEFINITION. */</span>
<span class="n">nStatus</span> <span class="o">=</span> <span class="n">KTR_init_problem</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">objGoal</span><span class="p">,</span> <span class="n">objType</span><span class="p">,</span>
        <span class="n">xLoBnds</span><span class="p">,</span> <span class="n">xUpBnds</span><span class="p">,</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">cType</span><span class="p">,</span> <span class="n">cLoBnds</span><span class="p">,</span> <span class="n">cUpBnds</span><span class="p">,</span>
        <span class="n">nnzJ</span><span class="p">,</span> <span class="n">jacIndexVars</span><span class="p">,</span> <span class="n">jacIndexCons</span><span class="p">,</span>
        <span class="n">nnzH</span><span class="p">,</span> <span class="n">hessIndexRows</span><span class="p">,</span> <span class="n">hessIndexCols</span><span class="p">,</span>
        <span class="n">xInitial</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nStatus</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="cm">/*... an error occurred ...*/</span>

        <span class="cm">/*... free xLoBnds, xUpBnds, etc. ...*/</span>
</pre></div>
</div>
<p>Assume for simplicity that the user writes three routines for computing
problem information. In <code class="file docutils literal"><span class="pre">examples/C/problemHS15.c</span></code> these are named
<em>computeFC</em>, <em>computeGA</em>, and <em>computeH</em>.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/*         FUNCTION callbackEvalFC                                  */</span>
<span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/** The signature of this function matches KTR_callback in knitro.h.</span>
<span class="cm"> *    Only &quot;obj&quot; and &quot;c&quot; are modified.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">callbackEvalFC</span> <span class="p">(</span>
            <span class="k">const</span> <span class="kt">int</span>               <span class="n">evalRequestCode</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">int</span>               <span class="n">n</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">int</span>               <span class="n">m</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">int</span>               <span class="n">nnzJ</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">int</span>               <span class="n">nnzH</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>    <span class="n">x</span><span class="p">,</span>
            <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>    <span class="n">lambda</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">obj</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">c</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">objGrad</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">jac</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">hessian</span><span class="p">,</span>
            <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span>          <span class="n">hessVector</span><span class="p">,</span>
            <span class="kt">void</span>   <span class="o">*</span>                <span class="n">userParams</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">evalRequestCode</span> <span class="o">!=</span> <span class="n">KTR_RC_EVALFC</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;*** callbackEvalFC incorrectly called with eval code %dn&quot;</span><span class="p">,</span>
                            <span class="n">evalRequestCode</span><span class="p">);</span>
            <span class="k">return</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>

        <span class="cm">/*---- IN THIS EXAMPLE, CALL THE ROUTINE IN problemDef.h. */</span>
        <span class="o">*</span><span class="n">obj</span> <span class="o">=</span> <span class="n">computeFC</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
        <span class="k">return</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>

<span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/*         FUNCTION callbackEvalGA                                  */</span>
<span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/** The signature of this function matches KTR_callback in knitro.h.</span>
<span class="cm"> *    Only &quot;objGrad&quot; and &quot;jac&quot; are modified.</span>
<span class="cm"> */</span>

        <span class="cm">/*... similar implementation to callbackEvalFC ...*/</span>

<span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/*         FUNCTION callbackEvalH                                   */</span>
<span class="cm">/*------------------------------------------------------------------*/</span>
<span class="cm">/** The signature of this function matches KTR_callback in knitro.h.</span>
<span class="cm"> *    Only &quot;hessian&quot; is modified.</span>
<span class="cm"> */</span>

        <span class="cm">/*... similar implementation to callbackEvalFC ...*/</span>
</pre></div>
</div>
<p>To write a driver program using callback mode, simply wrap each evaluation routine
in a function that matches the <em>KTR_callback()</em> prototype defined in
<code class="file docutils literal"><span class="pre">knitro.h</span></code>.       Note that all three wrappers use the same prototype.
This is in case the application finds it convenient to combine some of the
evaluation steps, as demonstrated in <code class="file docutils literal"><span class="pre">examples/C/callbackExample2.c</span></code>.</p>
<p>Back in the main program each wrapper function is registered as a callback
to Knitro, and then <a class="reference internal" href="../3_referenceManual/callableLibrary/API.html#KTR_solve" title="KTR_solve"><code class="xref c c-func docutils literal"><span class="pre">KTR_solve()</span></code></a> is invoked to find the solution:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/*---- REGISTER THE CALLBACK FUNCTIONS THAT PERFORM PROBLEM EVALS.</span>
<span class="cm"> *---- THE HESSIAN CALLBACK ONLY NEEDS TO BE REGISTERED FOR SPECIFIC</span>
<span class="cm"> *---- HESSIAN OPTIONS (E.G., IT IS NOT REGISTERED IF THE OPTION FOR</span>
<span class="cm"> *---- BFGS HESSIAN APPROXIMATIONS IS SELECTED).</span>
<span class="cm"> */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_func_callback</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callbackEvalFC</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_grad_callback</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callbackEvalGA</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
<span class="k">if</span> <span class="p">((</span><span class="n">nHessOpt</span> <span class="o">==</span> <span class="n">KTR_HESSOPT_EXACT</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">nHessOpt</span> <span class="o">==</span> <span class="n">KTR_HESSOPT_PRODUCT</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_hess_callback</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callbackEvalHess</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>

<span class="cm">/*---- SOLVE THE PROBLEM     */</span>
<span class="n">nStatus</span> <span class="o">=</span> <span class="n">KTR_solve</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lambda</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">obj</span><span class="p">,</span>
        <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">nStatus</span> <span class="o">!=</span> <span class="n">KTR_RC_OPTIMAL_OR_SATISFACTORY</span><span class="p">)</span>
        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Knitro failed to solve the problem, final status = %dn&quot;</span><span class="p">,</span> <span class="n">nStatus</span><span class="p">);</span>

<span class="cm">/*---- DELETE THE KNITRO SOLVER INSTANCE. */</span>
<span class="n">KTR_free</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">kc</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="otherProgInterfaces.html" class="btn btn-neutral float-right" title="Other programmatic interfaces" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="obtainingInformation.html" class="btn btn-neutral" title="Obtaining information" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Artelys.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'10.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>