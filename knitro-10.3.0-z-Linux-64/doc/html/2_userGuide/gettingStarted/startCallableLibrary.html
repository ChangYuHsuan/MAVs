

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head><div class = "head"> </div>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting started with the callable library &mdash; Artelys Knitro 10.3 User&#39;s Manual</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/Artelys_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Artelys Knitro 10.3 User&#39;s Manual" href="../../index.html"/>
        <link rel="up" title="Getting started" href="../gettingStarted.html"/>
        <link rel="next" title="Getting started with the object-oriented interface" href="startCPP.html"/>
        <link rel="prev" title="Getting started with MATLAB" href="startMatlab.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Artelys Knitro User's Manual
          

          
          </a>

          
            
            
              <div class="version">
                10.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../1_introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../2_userGuide.html">User guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../gettingStarted.html">Getting started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="startAmpl.html">Getting started with AMPL</a></li>
<li class="toctree-l3"><a class="reference internal" href="startMatlab.html">Getting started with MATLAB</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Getting started with the callable library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#first-example">First example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#further-information">Further information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#additional-examples">Additional examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="startCPP.html">Getting started with the object-oriented interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="startR.html">Getting started with R</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../knitroOptions.html">Setting options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../derivatives.html">Derivatives</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multistart.html">Multistart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../minlp.html">Mixed-integer nonlinear programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../complementarity.html">Complementarity constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ktrlsq.html">Nonlinear Least-Squares</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algorithms.html">Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../feasibility.html">Feasibility and infeasibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallelism.html">Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tuner.html">The Knitro-Tuner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../termination.html">Termination criteria</a></li>
<li class="toctree-l2"><a class="reference internal" href="../obtainingInformation.html">Obtaining information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../callbacks.html">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../otherProgInterfaces.html">Other programmatic interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../specialProblems.html">Special problem classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tips.html">Tips and tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../3_referenceManual.html">Reference manual</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Artelys Knitro User's Manual</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../2_userGuide.html">User guide</a> &raquo;</li>
      
          <li><a href="../gettingStarted.html">Getting started</a> &raquo;</li>
      
    <li>Getting started with the callable library</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started-with-the-callable-library">
<span id="startcallablelib"></span><h1>Getting started with the callable library</h1>
<p>Knitro is written in C and C++, with a well-documented application
programming interface (API) defined in the file <code class="file docutils literal"><span class="pre">knitro.h</span></code>
provided in the installation under the <code class="file docutils literal"><span class="pre">include</span></code> directory.</p>
<p>The Knitro callable library is typically used to solve an optimization
problem through a sequence of 5 basic function calls:</p>
<ul class="simple">
<li><a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_new" title="KTR_new"><code class="xref c c-func docutils literal"><span class="pre">KTR_new()</span></code></a>: create a new Knitro solver context pointer,
allocating resources.</li>
<li><a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_set_func_callback" title="KTR_set_func_callback"><code class="xref c c-func docutils literal"><span class="pre">KTR_set_func_callback()</span></code></a>: tell Knitro how to evaluate the
objective function and the constraints. (Callbacks must be set before
<a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_init_problem" title="KTR_init_problem"><code class="xref c c-func docutils literal"><span class="pre">KTR_init_problem()</span></code></a>)</li>
<li><a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_init_problem" title="KTR_init_problem"><code class="xref c c-func docutils literal"><span class="pre">KTR_init_problem()</span></code></a>, for continuous problems, or
<a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_mip_init_problem" title="KTR_mip_init_problem"><code class="xref c c-func docutils literal"><span class="pre">KTR_mip_init_problem()</span></code></a> for mixed-integer problems:
load the problem definition into the Knitro solver.</li>
<li><a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_solve" title="KTR_solve"><code class="xref c c-func docutils literal"><span class="pre">KTR_solve()</span></code></a> or <a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_mip_solve" title="KTR_mip_solve"><code class="xref c c-func docutils literal"><span class="pre">KTR_mip_solve()</span></code></a>: solve the problem.</li>
<li><a class="reference internal" href="../../3_referenceManual/callableLibrary/API.html#KTR_free" title="KTR_free"><code class="xref c c-func docutils literal"><span class="pre">KTR_free()</span></code></a>: delete the Knitro context pointer, releasing allocated resources.</li>
</ul>
<p>The example below shows how to use these function calls.</p>
<div class="section" id="first-example">
<h2>First example</h2>
<p>Again, let us consider the toy example that we already solved
twice, using AMPL and MATLAB. The C++ equivalent is the following.</p>
<div class="highlight-c"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;knitro.h&quot;</span><span class="cp"></span>


<span class="cm">/* callback function that evaluates the objective</span>
<span class="cm">   and constraints */</span>
<span class="kt">int</span>  <span class="nf">callback</span> <span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="n">evalRequestCode</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">m</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">nnzJ</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">int</span> <span class="n">nnzH</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">x</span><span class="p">,</span>
        <span class="k">const</span> <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">lambda</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">obj</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">c</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">objGrad</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">jac</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">hessian</span><span class="p">,</span>
              <span class="kt">double</span> <span class="o">*</span> <span class="k">const</span> <span class="n">hessVector</span><span class="p">,</span>
              <span class="kt">void</span> <span class="o">*</span> <span class="n">userParams</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">evalRequestCode</span> <span class="o">==</span> <span class="n">KTR_RC_EVALFC</span><span class="p">)</span> <span class="p">{</span>
                <span class="cm">/* objective function */</span>
                <span class="o">*</span><span class="n">obj</span>    <span class="o">=</span> <span class="mi">1000</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

                <span class="cm">/* constraints */</span>
                <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">14</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">7</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">56</span><span class="p">;</span>
                <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>    <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span><span class="mi">25</span><span class="p">;</span>

                <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
                <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Wrong evalRequestCode in callback function.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="k">return</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* main */</span>
<span class="kt">int</span>  <span class="nf">main</span> <span class="p">(</span><span class="kt">int</span>  <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
        <span class="kt">int</span>  <span class="n">nStatus</span><span class="p">;</span>

        <span class="cm">/* variables that are passed to Knitro */</span>
        <span class="n">KTR_context</span> <span class="o">*</span><span class="n">kc</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">nnzJ</span><span class="p">,</span> <span class="n">nnzH</span><span class="p">,</span> <span class="n">objGoal</span><span class="p">,</span> <span class="n">objType</span><span class="p">;</span>
        <span class="kt">int</span> <span class="o">*</span><span class="n">cType</span><span class="p">;</span>
        <span class="kt">int</span> <span class="o">*</span><span class="n">jacIndexVars</span><span class="p">,</span> <span class="o">*</span><span class="n">jacIndexCons</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">lambda</span><span class="p">;</span>
        <span class="kt">double</span> <span class="o">*</span><span class="n">xLoBnds</span><span class="p">,</span> <span class="o">*</span><span class="n">xUpBnds</span><span class="p">,</span> <span class="o">*</span><span class="n">xInitial</span><span class="p">,</span> <span class="o">*</span><span class="n">cLoBnds</span><span class="p">,</span> <span class="o">*</span><span class="n">cUpBnds</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="c1">// convenience variables</span>

        <span class="cm">/*problem size and mem allocation */</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">nnzJ</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">m</span><span class="p">;</span>
        <span class="n">nnzH</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">lambda</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">((</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

        <span class="n">xLoBnds</span>      <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">xUpBnds</span>      <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">xInitial</span>     <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">cType</span>        <span class="o">=</span> <span class="p">(</span><span class="kt">int</span>    <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
        <span class="n">cLoBnds</span>      <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">cUpBnds</span>      <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
        <span class="n">jacIndexVars</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span>    <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">nnzJ</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
        <span class="n">jacIndexCons</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span>    <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span> <span class="p">(</span><span class="n">nnzJ</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>

        <span class="cm">/* objective type */</span>
        <span class="n">objType</span> <span class="o">=</span> <span class="n">KTR_OBJTYPE_GENERAL</span><span class="p">;</span>
        <span class="n">objGoal</span> <span class="o">=</span> <span class="n">KTR_OBJGOAL_MINIMIZE</span><span class="p">;</span>

        <span class="cm">/* bounds and constraints type */</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">xLoBnds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
                <span class="n">xUpBnds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_INFBOUND</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cType</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">KTR_CONTYPE_GENERAL</span><span class="p">;</span>
                <span class="n">cLoBnds</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
                <span class="n">cUpBnds</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mf">0.0</span> <span class="o">:</span> <span class="n">KTR_INFBOUND</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="cm">/* initial point */</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="n">xInitial</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>

        <span class="cm">/* sparsity pattern (here, of a full matrix) */</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">jacIndexCons</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
                        <span class="n">jacIndexVars</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                        <span class="n">k</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>

        <span class="cm">/* create a Knitro instance */</span>
        <span class="n">kc</span> <span class="o">=</span> <span class="n">KTR_new</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">kc</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span> <span class="c1">// probably a license issue</span>

        <span class="cm">/* set options: automatic gradient and hessian matrix */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_int_param_by_name</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="s">&quot;gradopt&quot;</span><span class="p">,</span> <span class="n">KTR_GRADOPT_FORWARD</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_int_param_by_name</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="s">&quot;hessopt&quot;</span><span class="p">,</span> <span class="n">KTR_HESSOPT_BFGS</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_int_param_by_name</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="s">&quot;outlev&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>

        <span class="cm">/* register the callback function */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">KTR_set_func_callback</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">callback</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>

        <span class="cm">/* pass the problem definition to Knitro */</span>
        <span class="n">nStatus</span> <span class="o">=</span> <span class="n">KTR_init_problem</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">objGoal</span><span class="p">,</span> <span class="n">objType</span><span class="p">,</span>
                        <span class="n">xLoBnds</span><span class="p">,</span> <span class="n">xUpBnds</span><span class="p">,</span>
                        <span class="n">m</span><span class="p">,</span> <span class="n">cType</span><span class="p">,</span> <span class="n">cLoBnds</span><span class="p">,</span> <span class="n">cUpBnds</span><span class="p">,</span>
                        <span class="n">nnzJ</span><span class="p">,</span> <span class="n">jacIndexVars</span><span class="p">,</span> <span class="n">jacIndexCons</span><span class="p">,</span>
                        <span class="n">nnzH</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">xInitial</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

        <span class="cm">/* free memory (Knitro maintains its own copy) */</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">xLoBnds</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">xUpBnds</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">xInitial</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">cType</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">cLoBnds</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">cUpBnds</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">jacIndexVars</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">jacIndexCons</span><span class="p">);</span>

        <span class="cm">/* solver call */</span>
        <span class="n">nStatus</span> <span class="o">=</span> <span class="n">KTR_solve</span> <span class="p">(</span><span class="n">kc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lambda</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">obj</span><span class="p">,</span>
                <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">nStatus</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Knitro failed to solve the problem, final status = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">nStatus</span><span class="p">);</span>
        <span class="k">else</span>
                <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Knitro successful, objective is = %e</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>

        <span class="cm">/* delete the Knitro instance and primal/dual solution */</span>
        <span class="n">KTR_free</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">kc</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">free</span> <span class="p">(</span><span class="n">lambda</span><span class="p">);</span>

        <span class="k">return</span><span class="p">(</span> <span class="mi">0</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Note that the AMPL equivalent is both much shorter (only a few lines
of code) and more efficient in this case since, as we mentioned before,
AMPL provides automatic derivatives to Knitro behind the scenes. To achieve
the same efficiency in C, we would have to compute the derivatives manually,
code them in C and input them to Knitro using a callback similar to the one
we used to define the objective and constraints. We will show how to
do this in the chapter on <a class="reference internal" href="../derivatives.html#sec-derivatives"><span class="std std-ref">Derivatives</span></a>. However the callable
library has the advantage of greater control (for instance, on memory
usage) and allows one to embed Knitro in a native application seamlessly.</p>
<p>The above example can be compiled and linked against the Knitro
callable library with a standard C compiler. Its output is the following.</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span></span>=======================================
          Commercial License
         Artelys Knitro 10.0.0
=======================================

Knitro performing finite-difference gradient computation with 1 thread.
Knitro presolve eliminated 0 variables and 0 constraints.

gradopt:              2
hessopt:              2
outlev:               1
Knitro changing algorithm from AUTO to 1.
Knitro changing bar_initpt from AUTO to 3.
Knitro changing bar_murule from AUTO to 4.
Knitro changing bar_penaltycons from AUTO to 1.
Knitro changing bar_penaltyrule from AUTO to 2.
Knitro changing bar_switchrule from AUTO to 2.
Knitro changing linsolver from AUTO to 2.
Knitro performing finite-difference gradient computation with 1 thread.

Problem Characteristics                    ( Presolved)
-----------------------
Objective goal:  Minimize
Number of variables:                     3 (         3)
    bounded below:                       3 (         3)
    bounded above:                       0 (         0)
    bounded below and above:             0 (         0)
    fixed:                               0 (         0)
    free:                                0 (         0)
Number of constraints:                   2 (         2)
    linear equalities:                   0 (         0)
    nonlinear equalities:                1 (         1)
    linear inequalities:                 0 (         0)
    nonlinear inequalities:              1 (         1)
    range:                               0 (         0)
Number of nonzeros in Jacobian:          6 (         6)
Number of nonzeros in Hessian:           6 (         6)

EXIT: Locally optimal solution found.

Final Statistics
----------------
Final objective value               =   9.36000000000340e+02
Final feasibility error (abs / rel) =   7.11e-15 / 5.47e-16
Final optimality error  (abs / rel) =   1.37e-07 / 8.59e-09
# of iterations                     =          9
# of CG iterations                  =          0
# of function evaluations           =         44
# of gradient evaluations           =          0
Total program time (secs)           =       0.00357 (     0.001 CPU time)
Time spent in evaluations (secs)    =       0.00000

===============================================================================


Knitro successful, objective is = 9.360000e+02
</pre></div>
</td></tr></table></div>
<p>Again, the solution value is the same (about 936.0), and the details
of the log are slightly different. Note for instance that the log
mentions &#8220;linear equalities: 0&#8221; at line 31 although the first constraint
is indeed linear. Knitro (which only knows of the objective and constraint
though a callback function) cannot detect this: we should have told the
solver of the constraint linearity at line 80 of the C code above, by setting
the constraint type to <code class="xref c c-macro docutils literal"><span class="pre">KTR_CONTYPE_LINEAR</span></code>
instead of <code class="xref c c-macro docutils literal"><span class="pre">KTR_CONTYPE_GENERAL</span></code>.
If you go back to the AMPL example (<a class="reference internal" href="startAmpl.html#getstartampl"><span class="std std-ref">Getting started with AMPL</span></a>), you will see that
AMPL (which has an algebraic view of the optimization problem) detected
that the first constraint was linear and passed this information to Knitro, whose log
mentioned &#8220;linear equalities: 1&#8221;. This shows another advantage of modeling languages
over other interfaces: to some extent, they automatically detect the problem
structure and inform the solver (modeling languages are actually even able to <em>simplify</em>
the problem to some extent, by applying some <em>presolve</em> operations; see
<a class="reference internal" href="../obtainingInformation.html#presolve"><span class="std std-ref">AMPL presolve</span></a>).</p>
</div>
<div class="section" id="further-information">
<h2>Further information</h2>
<p>Another chapter of this documentation will be dedicated to
the callable library (<a class="reference internal" href="../callbacks.html#callback"><span class="std std-ref">Callbacks</span></a>), more specifically
to the communication mode between the solver and
the user-supplied optimization problem.</p>
<p>The reference manual (<a class="reference internal" href="../../3_referenceManual/callableLibraryReference.html#chap-callablelibrayreference"><span class="std std-ref">Callable library reference</span></a>)
also contains a comprehensive documentation
of the Knitro callable library.</p>
<p>Finally, the file <code class="file docutils literal"><span class="pre">knitro.h</span></code> contains many useful comments
and can be used as an ultimate reference.</p>
</div>
<div class="section" id="additional-examples">
<h2>Additional examples</h2>
<p>More C/C++ examples using the callable library are provided in
the <code class="file docutils literal"><span class="pre">examples/C</span></code> and <code class="file docutils literal"><span class="pre">examples/C++</span></code> directories of the Knitro
distribution.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="startCPP.html" class="btn btn-neutral float-right" title="Getting started with the object-oriented interface" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="startMatlab.html" class="btn btn-neutral" title="Getting started with MATLAB" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Artelys.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'10.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>